# 完成前驗證技能（Verification Before Completion）

> **技能 ID**: `verification-before-completion`
> **版本**: 1.0.0
> **用途**: 強制驗證步驟、防止假完成、確保修復有效
> **參考**: [obra/superpowers](https://github.com/obra/superpowers)

---

## 觸發條件

此技能應在以下情況**自動啟用**：

- 宣告任務完成之前
- 宣告修復成功之前
- 提交 commit 之前
- 創建 PR 之前
- 說「測試通過」之前

---

## 一、核心原則

```
╔════════════════════════════════════════════════════════════╗
║           證據先於宣稱，永遠如此                             ║
║           Evidence before claims, always.                  ║
╚════════════════════════════════════════════════════════════╝
```

在宣告任何狀態之前，必須：
1. **運行**驗證命令
2. **確認**實際輸出
3. **然後**才能做出宣稱

---

## 二、驗證閘門（The Gate）

### 五步驗證流程

```markdown
┌─────────────────────────────────────────────────────────┐
│                    驗證閘門                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1️⃣ 識別（Identify）                                    │
│     確定能證明宣稱的命令                                  │
│                                                         │
│  2️⃣ 運行（Run）                                         │
│     完整執行命令（不是部分執行）                          │
│                                                         │
│  3️⃣ 閱讀（Read）                                        │
│     完整閱讀輸出和退出碼                                  │
│                                                         │
│  4️⃣ 驗證（Verify）                                      │
│     輸出是否支持你的宣稱？                                │
│                                                         │
│  5️⃣ 宣稱（Claim）                                       │
│     只有在驗證通過後才做出宣稱                            │
│                                                         │
└─────────────────────────────────────────────────────────┘

跳過任何步驟 = 不誠實，而非效率
```

---

## 三、禁止用語

在驗證之前，**絕對不能**使用以下語言：

### 3.1 模糊成功詞

```markdown
❌ 禁止：
- "應該可以工作了"（should work）
- "可能修好了"（probably fixed）
- "看起來正常"（seems fine）
- "我認為這樣可以"（I think this works）
```

### 3.2 提前慶祝詞

```markdown
❌ 禁止：
- "太好了！"（Great!）
- "完美！"（Perfect!）
- "搞定！"（Done!）
- "修復了！"（Fixed!）
```

### 3.3 假設性宣稱

```markdown
❌ 禁止：
- "這應該能解決問題"
- "改完了，應該沒問題"
- "我已經修復了這個 bug"（未驗證）
```

---

## 四、驗證命令對照表

| 宣稱 | 驗證命令 | 預期結果 |
|------|---------|---------|
| "測試通過" | `npm test` | 所有測試綠燈 |
| "構建成功" | `npm run build` | 無錯誤、生成產物 |
| "Lint 通過" | `npm run lint` | 無警告/錯誤 |
| "類型檢查通過" | `npx tsc --noEmit` | 無錯誤 |
| "服務正常運行" | `curl localhost:3000/health` | 200 OK |
| "功能可用" | 實際操作 + 截圖 | 預期行為 |

---

## 五、常見不充分驗證

以下**不能**作為完成證據：

```markdown
❌ 不充分：
1. "測試之前通過過"
   → 必須重新運行

2. "只檢查了部分"
   → 必須完整檢查

3. "Linter 通過了"
   → 不證明功能正確

4. "代碼改了"
   → 不證明改對了

5. "Agent 說成功了"
   → 必須獨立驗證

6. "本地可以跑"
   → 不保證 CI 通過
```

---

## 六、驗證模板

### 6.1 任務完成驗證

```markdown
## ✅ 驗證報告

### 驗證命令
\`\`\`bash
npm test
\`\`\`

### 實際輸出
\`\`\`
 PASS  tests/feature.test.ts
 ✓ should handle valid input (15ms)
 ✓ should reject invalid input (8ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
\`\`\`

### 退出碼
0 (成功)

### 結論
✅ 測試通過，任務完成
```

### 6.2 Bug 修復驗證

```markdown
## ✅ Bug 修復驗證

### 重現步驟驗證
1. [步驟 1] - ✅ 不再發生
2. [步驟 2] - ✅ 正常行為

### 回歸測試
\`\`\`bash
npm test -- --grep "related tests"
\`\`\`
結果：全部通過

### 結論
✅ Bug 已修復，無回歸
```

---

## 七、Commit 前檢查清單

在執行 `git commit` 之前：

```markdown
□ 運行測試套件
  npm test

□ 檢查類型
  npx tsc --noEmit

□ 運行 Linter
  npm run lint

□ 構建成功
  npm run build

□ 功能手動驗證（如適用）

□ 所有檢查項目通過
  → 可以 commit
```

---

## 八、PR 前檢查清單

在創建 Pull Request 之前：

```markdown
□ 所有 commit 前檢查通過

□ 分支與主分支同步
  git pull origin main

□ 合併後測試通過
  git merge main && npm test

□ 變更文件審查
  git diff main...HEAD

□ 自我 Code Review 完成

□ 文檔更新（如適用）
```

---

## 九、禁止行為

```markdown
❌ 絕對禁止：
1. 在驗證之前使用成功性語言
2. 僅憑「我認為」就宣稱完成
3. 跳過驗證步驟以節省時間
4. 信任未經驗證的 Agent 報告
5. 在測試失敗時提交 commit
6. 在未驗證時創建 PR
7. 說「應該可以」而不說「我驗證過了」
```

---

## 十、自檢清單

```markdown
□ 我識別了正確的驗證命令
□ 我完整運行了驗證命令
□ 我閱讀了完整輸出
□ 輸出支持我的宣稱
□ 我沒有使用模糊成功詞
□ 我可以提供驗證證據
□ 我的宣稱基於實際輸出
```

---

## 參考資源

- [obra/superpowers - verification-before-completion](https://github.com/obra/superpowers)

---

**版本**: 1.0.0
**最後更新**: 2025-12-26
