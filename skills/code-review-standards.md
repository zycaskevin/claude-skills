# Code Review 標準技能（Code Review Standards）

> **技能 ID**: `code-review-standards`
> **版本**: 1.0.0
> **用途**: 統一 Review 請求與接收標準、定義嚴重度、規範溝通態度
> **參考**: [obra/superpowers](https://github.com/obra/superpowers)

---

## 觸發條件

當以下情況發生時，應激活此技能：

- 準備合併代碼 (Merge Request / Pull Request)
- 需要他人審查代碼
- 收到 Review 反饋
- 需要處理 PR 評論

---

## 一、核心原則

```
╔════════════════════════════════════════════════════════════╗
║    品質是設計出來的，不是測試出來的，更不是 Review 出來的    ║
║    Review 是最後一道防線，而不是品質保證的唯一手段           ║
║    Quality is designed, not tested, and certainly not      ║
║    reviewed into existence.                                ║
╚════════════════════════════════════════════════════════════╝
```

---

## 二、請求 Review (Requesting)

### 2.1 自我預審清單 (Pre-Review)

在發送請求前，必須完成：

```markdown
□ **功能正確**: 代碼實現了預期功能，且邊界情況已處理
□ **代碼規範**: 遵循專案命名與風格規範 (Lint 通過)
□ **測試覆蓋**: 關鍵路徑有測試覆蓋，且測試全部通過
□ **安全性**: 無硬編碼敏感資訊，輸入已驗證 (無 SQL Injection/XSS)
□ **自我對答**: 問自己「這段代碼三個月後我還看得懂嗎？」
```

### 2.2 標準請求模板

```markdown
## 🔍 Code Review 請求

### 變更摘要
[簡述這次變更解決了什麼問題]

### 變更類型
- [ ] ✨ 新功能 (feat)
- [ ] 🐛 Bug 修復 (fix)
- [ ] ♻️ 重構 (refactor)
- [ ] 🚀 效能優化 (perf)

### 測試驗證
\`\`\`bash
npm test
# 輸出：✅ All tests passed
\`\`\`

### 關注點 (Reviewers Please Focus On)
1. [具體關注點 1 - 例如：這個遞迴邏輯是否會影響效能？]
2. [具體關注點 2 - 例如：命名是否夠語意化？]

### 相關資源
- Issue: #123
```

---

## 三、接收 Review (Receiving)

### 3.1 核心溝通原則

```
╔════════════════════════════════════════════════════════════╗
║    先驗證，再實現。技術正確優先於社交舒適。                  ║
║    Verify before implementing.                             ║
║    Technical correctness over social comfort.              ║
╚════════════════════════════════════════════════════════════╝
```

**🚫 禁止表演性回應**：

- ❌ "你說得太對了！" (未驗證前)
- ❌ "這個建議太棒了！" (只為了討好)

**✅ 正確回應**：

- "我理解你的建議是...，讓我驗證一下。"
- "驗證完成，你的建議是正確的，現在實現。"
- "經過驗證，這個修改可能會影響...，我們需要討論。"

### 3.2 處理反饋流程

1. **完整閱讀**: 讀完所有評論，識別關聯性。
2. **重述需求**: 如果不確定，先回覆「我確認一下，你的意思是...？」
3. **驗證代碼**: 不要憑空想像，去跑代碼、寫測試驗證建議的可行性。
4. **回應**:
    - **接受**: 「已驗證並修復，commit hash: abc1234」
    - **討論**: 「這個建議會導致 [副作用]，建議改用 [方案 B]，你覺得呢？」

---

## 四、嚴重度分類標準

| 等級 | 圖示 | 定義 | 處理方式 |
|:---:|:---:|:---|:---|
| **Critical** | 🔴 | **阻塞合併**。導致系統崩潰、資料遺失、安全漏洞。 | 必須立即修復 |
| **Important** | 🟠 | **阻塞合併**。功能錯誤、效能問題、明顯規範違反。 | 必須修復 |
| **Minor** | 🟡 | **不阻塞**。代碼風格、註解改進、變數命名建議。 | 可以在後續 PR 處理，或由作者決定 |
| **Bikeshed** | 🔵 | **不阻塞**。純粹個人偏好 (Nitpick)，無對錯之分。 | 作者可忽略 |

---

## 五、禁止行為

```markdown
❌ 絕對禁止：
1. **忽略 Critical/Important 問題**：帶著未修復的紅燈強行合併。
2. **防禦性反應**：把別人的技術建議當作人身攻擊。
3. **沒有理由的反駁**：只說「我不喜歡」而沒有技術論據。
4. **一次丟出巨大 PR**：變更超過 500 行核心邏輯 (不含自動生成文件)。
5. **在 Review 期間大改**：如果需要重寫，請關閉 PR 重開。
```

---

## 六、自檢清單 (Post-Implementation)

```markdown
□ 所有 Critical/Important 問題已修復
□ 對於未採納的建議，已給出技術理由
□ 修正後的代碼已通過測試
□ CI Pipeline 全綠
```

## 參考資源

- [Google Engineering Practices - Code Review](https://google.github.io/eng-practices/review/)
