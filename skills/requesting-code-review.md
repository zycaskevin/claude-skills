# 請求 Code Review 技能（Requesting Code Review）

> **技能 ID**: `requesting-code-review`
> **版本**: 1.0.0
> **用途**: 預審查清單、按嚴重度評估、規格對照驗證
> **參考**: [obra/superpowers](https://github.com/obra/superpowers)

---

## 觸發條件

當以下情況發生時，應激活此技能：

- 完成主要功能開發
- 準備合併到主分支
- 需要第二意見
- 完成複雜 Bug 修復
- 重構後需要驗證

---

## 一、核心原則

```
╔════════════════════════════════════════════════════════════╗
║         問題越早發現，修復成本越低                           ║
║    Issues caught early cost less to fix than issues found  ║
║    late or in production.                                  ║
╚════════════════════════════════════════════════════════════╝
```

---

## 二、何時請求 Review

### 2.1 必須請求

```markdown
🔴 必須請求 Review：
- ✅ 每個子 Agent 任務完成後
- ✅ 主要功能完成時
- ✅ 合併到 main 之前
- ✅ 涉及安全相關代碼
- ✅ 修改核心業務邏輯
```

### 2.2 建議請求

```markdown
🟡 建議請求 Review：
- 卡住時需要新視角
- 重構之前/之後
- 複雜 Bug 修復後
- 涉及多模組變更
- 第一次使用新技術
```

---

## 三、自我預審清單

在請求他人 Review 之前，先完成自我審查：

### 3.1 功能正確性

```markdown
□ 代碼實現了預期功能
□ 邊界情況已處理
□ 錯誤情況已處理
□ 測試覆蓋關鍵路徑
□ 沒有明顯 bug
```

### 3.2 代碼品質

```markdown
□ 遵循專案代碼規範
□ 命名清晰有意義
□ 函數/方法職責單一
□ 沒有重複代碼
□ 沒有過度工程
□ 註解解釋「為什麼」而非「什麼」
```

### 3.3 安全性

```markdown
□ 無硬編碼敏感資訊
□ 輸入已驗證/清理
□ 無 SQL 注入風險
□ 無 XSS 風險
□ 權限檢查正確
```

### 3.4 效能

```markdown
□ 無明顯 N+1 查詢
□ 無不必要的迴圈
□ 大數據有分頁
□ 適當使用索引
□ 無記憶體洩漏風險
```

### 3.5 可維護性

```markdown
□ 容易理解
□ 容易修改
□ 有適當測試
□ 文檔已更新
□ 依賴最小化
```

---

## 四、Review 請求格式

### 4.1 標準請求模板

```markdown
## 🔍 Code Review 請求

### 變更摘要
[簡述這次變更做了什麼]

### 變更類型
- [ ] 新功能
- [ ] Bug 修復
- [ ] 重構
- [ ] 效能優化
- [ ] 其他: ____

### 涉及文件
- `src/services/user.ts` - 新增用戶驗證邏輯
- `src/controllers/auth.ts` - 調用新驗證服務
- `tests/user.test.ts` - 新增測試

### 測試驗證
\`\`\`bash
npm test
# 輸出：全部通過
\`\`\`

### 關注點
請特別關注：
1. [具體關注點 1]
2. [具體關注點 2]

### 相關資源
- 規格文檔: [連結]
- Issue: #123
```

### 4.2 簡化請求模板

```markdown
## Review 請求

**變更**: [一句話描述]
**Commit**: abc1234..def5678
**測試**: ✅ 全部通過

**請關注**:
1. [關注點]
```

---

## 五、嚴重度分類

### 5.1 嚴重度定義

| 等級 | 圖示 | 定義 | 處理方式 |
|------|------|------|----------|
| **Critical** | 🔴 | 會導致系統崩潰、資料遺失、安全漏洞 | 立即修復 |
| **Important** | 🟠 | 功能錯誤、效能問題、代碼規範違反 | 合併前修復 |
| **Minor** | 🟡 | 風格問題、小改進、非必要優化 | 記錄追蹤 |
| **Suggestion** | 🔵 | 建議性改進、可選優化 | 酌情處理 |

### 5.2 處理優先級

```markdown
1. 🔴 Critical - 立即處理，阻塞合併
2. 🟠 Important - 當前 PR 處理
3. 🟡 Minor - 可以後續處理
4. 🔵 Suggestion - 記錄評估
```

---

## 六、接收反饋

### 6.1 正確態度

```markdown
✅ 正確態度：
- 感謝反饋
- 認真考慮每個建議
- 學習新視角
- 解釋決策理由

❌ 錯誤態度：
- 防禦性回應
- 忽略反饋
- 不解釋就拒絕
- 認為反饋是攻擊
```

### 6.2 回應模板

```markdown
# Critical 問題回應
感謝指出！這確實是個問題。
修復方案：[描述]
已在 commit abc123 修復。

# 有分歧的回應
感謝建議！我理解你的考量。
選擇當前方案的原因是：
1. [理由 1]
2. [理由 2]
你怎麼看？

# Minor 問題確認
已記錄，會在後續 PR 處理。
追蹤 Issue: #456
```

---

## 七、Review 檢查清單

```markdown
## Pre-Review 自檢

### 基本檢查
□ 代碼可編譯
□ 測試通過
□ Lint 通過
□ 沒有合併衝突

### 變更範圍
□ 只包含相關變更
□ 沒有無關修改
□ Commit 訊息清晰

### 文檔
□ README 更新（如需要）
□ API 文檔更新（如需要）
□ 註解完整

### 測試
□ 新功能有測試
□ Bug 修復有回歸測試
□ 邊界情況有測試

## Post-Review 處理

□ 所有 Critical 已修復
□ 所有 Important 已處理
□ Minor 已記錄或處理
□ 更新已推送
□ 再次請求 Review（如需要）
```

---

## 八、禁止行為

```markdown
❌ 絕對禁止：
1. 因為「簡單」就跳過 Review
2. 忽略 Critical 問題
3. 帶著未修復的 Important 繼續
4. 沒有技術理由就反駁反饋
5. 提交未測試的代碼
6. 在 Review 期間繼續大改
7. 把 Review 當作橡皮圖章
```

---

## 九、自檢清單

```markdown
□ 完成自我預審
□ 測試全部通過
□ Review 請求包含必要信息
□ 標註需要關注的點
□ 準備好解釋設計決策
□ 態度開放接受反饋
```

---

## 參考資源

- [obra/superpowers - requesting-code-review](https://github.com/obra/superpowers)
- [Google Code Review Guidelines](https://google.github.io/eng-practices/review/)

---

**版本**: 1.0.0
**最後更新**: 2025-12-26
